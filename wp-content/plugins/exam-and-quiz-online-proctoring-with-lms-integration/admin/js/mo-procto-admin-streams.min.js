$=jQuery;let current_streams={},global_data=null;function makeDivActive(e,t){t.forEach(t=>{t==e?($(t).css("background-color","#476d89"),$(t).css("color","#fff")):($(t).css("background-color","#ccc"),$(t).css("color","#000"))})}function make_calls(t,o){let n=new Peer;n.on("open",function(a){var r=[];if(o){let i=t;JSON.stringify(current_streams)===JSON.stringify({})&&(document.getElementById("streams").innerHTML=""),t=Object.fromEntries(t=Object.entries(t).filter(function([e,t]){return!(e in current_streams)||current_streams[e].id!==t.id})),current_streams=i}else current_streams=t,document.getElementById("streams").innerHTML="";for(key in t){let c=t[key].id,s=t[key].name,m=document.createElement("div");m.innerText=s||"guest",m.classList.add("mo-procto-stream-name");let l=document.createElement("div");l.classList.add("mo-procto-stream"),r[c]=n.call(c,e),r[c].on("stream",function(e){if(null==document.getElementById(s)){let t=document.createElement("video");t.autoplay=!0,t.muted=!0,t.height=150,t.id=s,t.classList.add("mo-procto-video-stream"),l.appendChild(t),l.appendChild(m),document.getElementById("streams").appendChild(l)}document.getElementById(s).srcObject=e})}$(".mo-procto-video-stream").click(function(){$(this).parent().show(),$(this).parent().toggleClass("mo-procto-focus")})}),n.on("error",function(e){}),n.on("connection",function(e){}),n.on("close",function(e){}),n.on("disconnected",function(e){})}let timeoutId;const debouncedSearch=e=>{clearTimeout(timeoutId),timeoutId=setTimeout(()=>{$(".mo-procto-stream").each(function(){let t=$(this);t.find(".mo-procto-stream-name").text().includes(e)?t.show():t.hide()})},200)};if($(document).ready(function(){let e=["#mo-procto-small","#mo-procto-medium","#mo-procto-large",];$("#mo-procto-small").click(function(){makeDivActive("#mo-procto-small",e),$(".mo-procto-stream").animate({height:"50px"}),$(".mo-procto-stream").find("video").animate({height:"50px"})}),$("#mo-procto-medium").click(function(){makeDivActive("#mo-procto-medium",e),$(".mo-procto-stream").animate({height:"150px"}),$(".mo-procto-stream").find("video").animate({height:"150px"})}),$("#mo-procto-large").click(function(){makeDivActive("#mo-procto-large",e),$(".mo-procto-stream").animate({height:"250px"}),$(".mo-procto-stream").find("video").animate({height:"250px"})}),$("#mo-procto-video-search").keyup(e=>{debouncedSearch(e.target.value)}),$(".mo-procto-stream").click(function(){$(".mo-procto-stream").show(),$(this).toggleClass("mo-procto-focus")})}),window.RTCPeerConnection&&window.RTCDataChannel){var e;$("#mo_procto_select_quiz_live_stream").change(function(){let t=jQuery("#mo_procto_select_quiz_live_stream").val();navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(o=>{e=o;var n={action:"mo_procto_view_report",quiz_id:t,live_stream:!0,nonce:mo_procto_ajax_object.nonce};global_data=n,jQuery.post(mo_procto_ajax_object.mo_procto_ajax_url,n,function(e){0==e.length?document.getElementById("streams").innerHTML="<div class='mo-procto-empty-msg'>Oops! Can't find candidates.</div>":make_calls(e,!1)})}).catch(e=>{"NotAllowedError"===e.name&&alert("Camera and microphone Permission is required. Please reset the permissions and start again.")}):alert("Could not find camera device")})}else alert("Your browser doesn't support our plugin.");setInterval(()=>{global_data&&jQuery.post(mo_procto_ajax_object.mo_procto_ajax_url,global_data,function(e){0==e.length?document.getElementById("streams").innerHTML="<div class='mo-procto-empty-msg'>Oops! Can't find candidates.</div>":make_calls(e,!0)})},5e3);